# ADR-016: Email Integration for Coach Submission

## Status
Proposed

## Context
The core purpose of the Sideline Stats project is to track metrics and ensure submission to coaches. Currently, users can download CSV files but there's no streamlined process for submitting this data to coaches via email. This creates a critical gap in the workflow - users have the data but no easy way to deliver it to the intended recipients. The goal is to create a free, seamless solution that encourages and facilitates coach submission as part of the natural post-match flow.

### Current Submission Problems
1. **Manual Process**: Users must manually create emails and attach files
2. **Forgotten Submissions**: No reminder or encouragement to submit to coaches
3. **Inconsistent Format**: Users may not include proper subject lines or context
4. **Multiple Steps**: Download â†’ Open email client â†’ Attach â†’ Send
5. **No Coach Integration**: No direct connection to coach contact information
6. **Free Solution Constraint**: Must work without paid email services

### User Workflow Gap
```
Current Flow:
Match Ends â†’ Download CSV â†’ [User Responsibility] â†’ Email Coach

Desired Flow:
Match Ends â†’ Email Coach with CSV â†’ [Automated] â†’ Done
```

## Decision
Implement **integrated email submission** that automatically creates pre-formatted emails with CSV attachments, relevant subject lines, and comprehensive match information, making coach submission the default and encouraged action.

### Email Integration Strategy

#### 1. Mailto Protocol Implementation
- **Free Solution**: Uses standard `mailto:` protocol (no costs)
- **Pre-filled Content**: Auto-populates subject, body, and attachment reference
- **Universal Compatibility**: Works on all devices and email clients
- **Fallback Support**: Graceful degradation if mailto fails

#### 2. Smart Email Composition
```javascript
// Email template system
const emailTemplate = {
  subject: `Match Report: ${opponentName} - ${date}`,
  body: `Coach,

Here are the match statistics from today's game:

ğŸ† Match: Us vs ${opponentName}
âš¡ Final Score: ${myScore}-${opponentScore}
â±ï¸ Duration: ${duration}
ğŸ“ Events: ${events.length} recorded

ğŸ“Š Key Statistics:
- Goals scored: ${ourGoals}
- Goals conceded: ${theirGoals}
- Scoring timeline: [detailed breakdown]

ğŸ“ Detailed CSV data is attached for your analysis.

Best regards,
${userName} - Sideline Stats Tracker

---
Generated by Sideline Stats App
Date: ${new Date().toLocaleDateString()}
`,
  attachment: csvData
};
```

#### 3. Enhanced Export Modal
```
Export Decision Modal (Enhanced)
â”œâ”€â”€ Copy Summary
â”œâ”€â”€ Download CSV
â”œâ”€â”€ ğŸ†• Email Coach (Primary Action)
â”‚   â”œâ”€â”€ Auto-populated email
â”‚   â”œâ”€â”€ CSV attachment reference
â”‚   â”œâ”€â”€ Pre-formatted subject/body
â”‚   â””â”€â”€ One-click submission
â””â”€â”€ Skip Export (with warning)
```

#### 4. Coach Contact Management
```javascript
// Coach contact store
const coachContacts = {
  primary: {
    name: "Coach Smith",
    email: "coach@team.com",
    role: "Head Coach"
  },
  assistants: [
    { name: "Assistant Coach", email: "asst@team.com" }
  ],
  preferences: {
    defaultRecipient: 'primary',
    ccAssistants: true,
    includeDetailedStats: true
  }
};
```

### Implementation Architecture

#### 1. Email Generation System
```javascript
class EmailSubmissionService {
  generateEmailContent(matchData, coachInfo) {
    return {
      to: coachInfo.email,
      subject: this.generateSubject(matchData),
      body: this.generateBody(matchData, coachInfo),
      attachment: this.generateCSV(matchData)
    };
  }

  generateSubject(matchData) {
    const date = new Date(matchData.timestamp).toLocaleDateString();
    const result = matchData.myScore > matchData.opponentScore ? 'WIN' : 'LOSS';
    return `ğŸ“Š Match Report: ${matchData.opponentName} (${result}) - ${date}`;
  }

  generateBody(matchData, coachInfo) {
    const stats = this.calculateStats(matchData);
    return `Dear ${coachInfo.name},

${this.generateMatchSummary(matchData)}
${this.generateDetailedStats(stats)}
${this.generateActionItems(stats)}

The complete CSV data is attached for your detailed analysis.

Best regards,
Sideline Stats Tracker
${new Date().toLocaleDateString()}`;
  }

  openEmailClient(emailData) {
    const { to, subject, body } = emailData;
    const mailtoUrl = `mailto:${to}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    
    // Open email client
    window.location.href = mailtoUrl;
    
    // Show attachment instructions
    this.showAttachmentInstructions(emailData.attachment);
  }
}
```

#### 2. Attachment Handling
```javascript
// CSV attachment management
const attachmentService = {
  generateAttachment(matchData) {
    const csvContent = this.generateEnhancedCSV(matchData);
    const filename = this.generateFilename(matchData);
    
    // Create downloadable file
    const blob = new Blob([csvContent], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    
    return {
      filename,
      content: csvContent,
      downloadUrl: url,
      instructions: this.generateAttachmentInstructions(filename)
    };
  },

  generateAttachmentInstructions(filename) {
    return `
ğŸ“ ATTACHMENT INSTRUCTIONS:
1. After your email client opens, click "Attach File"
2. Select the downloaded file: ${filename}
3. The file contains complete match statistics for analysis

ğŸ’¡ TIP: The file is saved in your Downloads folder for easy access.
    `;
  }
};
```

#### 3. Enhanced Export Flow
```jsx
const EnhancedExportModal = ({ matchData, onClose }) => {
  const [emailMode, setEmailMode] = useState(false);
  const [coachInfo, setCoachInfo] = useState(null);

  const handleEmailSubmission = () => {
    const emailService = new EmailSubmissionService();
    const emailData = emailService.generateEmailContent(matchData, coachInfo);
    
    // Open email client
    emailService.openEmailClient(emailData);
    
    // Show attachment instructions
    setEmailMode(true);
  };

  return (
    <Modal>
      {!emailMode ? (
        <ExportOptions>
          <Button primary onClick={handleEmailSubmission}>
            ğŸ“§ Email Coach (Recommended)
          </Button>
          <Button onClick={downloadCSV}>
            ğŸ“ Download CSV Only
          </Button>
          <Button onClick={copySummary}>
            ğŸ“‹ Copy Summary
          </Button>
        </ExportOptions>
      ) : (
        <AttachmentInstructions>
          <h3>ğŸ“§ Email Opened!</h3>
          <p>Your email client has opened with the match report.</p>
          <AttachmentGuide />
          <Button onClick={onClose}>Done</Button>
        </AttachmentInstructions>
      )}
    </Modal>
  );
};
```

### User Experience Design

#### Primary Submission Flow
```
Match Ends â†’ Export Modal â†’ "Email Coach" â†’ Email Client Opens â†’ Attach CSV â†’ Send
```

#### Visual Design Elements
- **Prominent Email Button**: Primary action in export modal
- **Coach Branding**: Personalized with coach name and team
- **Clear Instructions**: Step-by-step attachment guidance
- **Success Feedback**: Confirmation when email is sent

#### Mobile Optimization
- **One-Click Email**: Single tap to open email client
- **Attachment Helper**: Visual guide for attaching files
- **Auto-complete**: Pre-filled coach email addresses
- **Quick Actions**: Fast access to frequent recipients

## Consequences
- âœ… **Streamlined Submission**: One-click email creation with all data
- âœ… **Coach Integration**: Direct connection to coach communication
- âœ… **Professional Format**: Consistent, well-formatted emails
- âœ… **Free Solution**: No costs using standard mailto protocol
- âœ… **Higher Submission Rate**: Encouraged by easy process
- âš ï¸ **Email Client Dependency**: Requires user to complete email sending
- âš ï¸ **Attachment Manual**: Users must manually attach CSV file
- âš ï¸ **Client Compatibility**: Different email clients may behave differently

## Success Metrics
- **Submission Rate**: 80% of matches emailed to coaches within 24 hours
- **Coach Engagement**: Increased response rate from coaches
- **User Satisfaction**: Improved feedback on submission process
- **Data Quality**: More consistent and complete data reaching coaches

## Implementation Priority
**Priority**: HIGH
**Effort**: 20 hours
**Dependencies**: None (can be implemented independently)
**Timeline**: Phase 1 of Core Feature Implementation

## Technical Requirements

### Email Service Architecture
```javascript
// Main email service
class CoachEmailService {
  constructor() {
    this.coachContacts = new CoachContactManager();
    this.templateEngine = new EmailTemplateEngine();
    this.attachmentService = new CSVAttachmentService();
  }

  async submitMatchReport(matchId, coachId) {
    const matchData = this.getMatchData(matchId);
    const coachInfo = this.coachContacts.getCoach(coachId);
    
    const emailContent = this.templateEngine.generateEmail(matchData, coachInfo);
    const attachment = this.attachmentService.createAttachment(matchData);
    
    return this.openEmailClient(emailContent, attachment);
  }
}
```

### Store Extensions
```javascript
// Email submission state
const emailState = {
  coachContacts: [],
  defaultCoach: null,
  lastSubmission: null,
  submissionHistory: []
};

// Email actions
const emailActions = {
  addCoachContact: (coach) => { /* implementation */ },
  setDefaultCoach: (coachId) => { /* implementation */ },
  submitToCoach: (matchId, coachId) => { /* implementation */ },
  trackSubmission: (submissionData) => { /* implementation */ }
};
```

## Testing Requirements
- **Email Client Compatibility**: Test across multiple email clients
- **Mobile Functionality**: Verify mailto works on iOS/Android
- **Content Formatting**: Ensure email content displays correctly
- **Attachment Process**: Test file attachment instructions
- **Coach Contact Management**: Verify contact storage and retrieval

## Future Enhancements
- **Direct Email API**: Integration with email services for automatic sending
- **Coach Portal**: Web portal for coaches to receive and view submissions
- **Analytics Dashboard**: Track submission rates and coach engagement
- **Automated Reminders**: Follow-up emails if no submission within 24 hours
- **Multiple Recipients**: CC assistant coaches and team managers

---

*This ADR addresses the core mission of the project by implementing a free, streamlined email submission system that makes coach submission the default and encouraged action, ensuring that valuable match data reaches its intended recipients.*
